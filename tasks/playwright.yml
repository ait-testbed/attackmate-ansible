---
# Update apt cache so we get the latest packages
- name: Update apt cache for Playwright
  become: true
  ansible.builtin.apt:
    update_cache: yes
    cache_valid_time: 3600
  when: attackmate_playwright
  tags:
    - install
    - playwright

# Install the system‚Äêlevel libraries Playwright needs
- name: Install system dependencies for Playwright
  become: true
  ansible.builtin.package:
    name: "{{ attackmate_playwright_system_packages }}"
    state: present
  when: attackmate_playwright
  tags:
    - install
    - playwright

# Install the Python Playwright package into our virtualenv
- name: Install Playwright Python package in venv
  become: true
  ansible.builtin.pip:
    name: "{{ attackmate_playwright_pip_packages }}"
    chdir: "{{ attackmate_dest }}"
    executable: "{{ attackmate_dest }}/venv/bin/pip"
  when: attackmate_playwright
  tags:
    - install
    - playwright

# Install browsers via the Playwright CLI
- name: Install Playwright browsers
  ansible.builtin.command: "{{ attackmate_dest }}/venv/bin/playwright install"
  args:
    chdir: "{{ attackmate_dest }}"
  become: false
  when: attackmate_playwright
  tags:
    - install
    - playwright
